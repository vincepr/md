"use strict";(self.webpackChunkmd=self.webpackChunkmd||[]).push([[1357],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),c=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(o.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),h=r,k=u["".concat(o,".").concat(h)]||u[h]||m[h]||l;return n?a.createElement(k,s(s({ref:t},p),{},{components:n})):a.createElement(k,s({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,s=new Array(l);s[0]=h;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[u]="string"==typeof e?e:r,s[1]=i;for(var c=2;c<l;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6370:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const l={},s="Async Await Task in csharp",i={unversionedId:"csharp/examples/AsyncAwaitTask",id:"csharp/examples/AsyncAwaitTask",title:"Async Await Task in csharp",description:"- Task is the Promise/Future equivalent of Csharp.",source:"@site/docs/csharp/examples/AsyncAwaitTask.md",sourceDirName:"csharp/examples",slug:"/csharp/examples/AsyncAwaitTask",permalink:"/md/csharp/examples/AsyncAwaitTask",draft:!1,editUrl:"https://github.com/vincepr/md/blob/main/docs/csharp/examples/AsyncAwaitTask.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"a backlog of videos / tutorials that look promising",permalink:"/md/csharp/backlog"},next:{title:"CancellationToken in Csharp",permalink:"/md/csharp/examples/CancellationToken"}},o={},c=[{value:"ConfigureAwait",id:"configureawait",level:2},{value:"Blocking",id:"blocking",level:2},{value:"Example",id:"example",level:2}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"async-await-task-in-csharp"},"Async Await Task in csharp"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Task is the Promise/Future equivalent of Csharp."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Something that will take time to finish. Ex. a DB-Query or a API call."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"this will first syntax will consume extra memory/processor")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://medium.com/@ranjeetdotme/how-async-await-works-in-c-eccf16bd3b90"},"https://medium.com/@ranjeetdotme/how-async-await-works-in-c-eccf16bd3b90")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public async Task<string> InputOutput() {\n    var msg = "Hello World";\n    return msg;\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the next 2 examples will wait till completed then return (with and without an result)"),(0,r.kt)("li",{parentName:"ul"},"no extra state-machine will get spawned, just simple sequential execution"),(0,r.kt)("li",{parentName:"ul"},"these just pass down the promise thus no care about blocking/awaiting has to happen in this part, it will all be handled upstream")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public Task<string> IOCompletedWithResult() {\n    var msg = "Hello World";\n    return Task.FromResult(msg);\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public Task<string> IOCompletedNoResult() {\n    var msg = "Hello World";\n    return Task.CompletedTask;\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"so there is (a small) benefit to wait as long as possible to change to async\nand for example propagate the ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public Task<string> InputOutputNetwork {\n    var client = new HttpClient();\n    return client.GetStringAsync("https://some.site");\n    // instead of awaiting it here directly\n    // response = await client.GetStringAsync("https://some.site);\n    // return response;     // especially if we need to validate/transform the response we can only await it here and not upstream\n}\n')),(0,r.kt)("h2",{id:"configureawait"},"ConfigureAwait"),(0,r.kt)("p",null,"ConfigureAwait(false) basically tells that it is ok to return this to any thread. (true the default will always continue on the same thread)"),(0,r.kt)("p",null,"Some rough rules about when to use it."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"for a api/webapp we can basically use .ConfigureAwait(false) for some extra performance without too much worry"),(0,r.kt)("li",{parentName:"ul"},"on some desktop/wpf app on the other hand this will cause big problems.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'public async Task<string> InputOutput() {\n    var client = new HttpClient();\n    var content = await client.GetStringAsync("https://some.site")\n        .ConfigureAwait(false);\n    return content;\n} \n')),(0,r.kt)("h2",{id:"blocking"},"Blocking"),(0,r.kt)("p",null,"In most cases we DO NOT want to block. But for those other cases:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"public IActionResult Index() {\n    var task = InputOutput();\n\n    // 3 ways to execute while blocking the whole thread:\n\n    // blocks the whole Thread. USE WITH CARE!\n    var a = task.Result();\n    \n    // blocks the whole Thread. USE WITH CARE!\n    task.Wait();\n\n    // blocks the whole Thread. USE WITH CARE!\n    task.GetAwaiter().GetResult();\n\n    return a;\n}\n")),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},'static void Main(string[] args){\n    // we block here in the main, waiting for our whole app to finish\n    StartApp().GetAwaiter().GetResult();\n}\npublic static Task StartApp(){\n    // start our Tasks\n    var collect = CollectFromDb();\n    var process = FetchFromApi("some.site.st");\n\n    // We could block and wait on the Task, that completes when everything has finished:\n    //     Task.WaitAll(new[] { collect, process });\n\n    // or we propagate the task upstream and let main handle it:\n    return Task.WhenAll(new[] { collect, process });\n    \n}\npublic static async Task CollectFromDb(){\n    while (true){\n        // reading some data from a slow Drive\n    }\n}\npublic static async Task FetchFromApi(string msg){\n    while (true){\n        // fetching some network responses here\n    }\n}\n')))}u.isMDXComponent=!0}}]);